# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта

- src/components/ — папка с JS компонентами

- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы

- src/types/index.ts — файл с типами

- src/index.ts — точка входа приложения

- src/scss/styles.scss — корневой файл стилей

- src/utils/constants.ts — файл с константами

- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Базовые типы

```
export type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';
```

```
export type TOrder = Pick<IOrder, 'payment' | 'address' | 'email' | 'phone'>;
```

Страница магазина

```
export interface IPage {
	catalog: IProductModel[];
	basket: string[];
	order: IOrder | null;
	basketTotal: number;
	preview: string | null;
}
```

Карточка товара

```
export interface IProductModel {
	id: string;
	index: number;
	category: string;
	title: string;
	image: string;
	description: string;
	price: number;
}
```

Заказ

```
export interface IOrder {
	items: string[];
	payment: string;
	email: string;
	phone: string;
	address: string;
	total: number;
}
```

Результат заказа

```
export interface IOrderResult {
	id: string;
}
```

Тип для ошибок в формах

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Интерфейс для апи

```
export interface IApi {
	getProducts: () => Promise<IProductModel[]>;
	orderProducts(order: IOrder): Promise<IOrderResult>;
}
```

## Архитектура приложения

Код приложения разделен на слоя, что соответствует парадигме MVP:

- слой данных, отвечает за работу, хранение и изменение данных,

- слой представления, отвечает за отображение данных на странице,

- презентер, отвечает за установку взаимодействия между слоями данных и представления.

### Базовый код

#### Класс Api

Класс `Api` cодержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. `constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).

Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер

- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
  handleResponse.

#### Класс AppApi

Используется для расширения базового класса `Api` специальными методами.

```
export class AppApi extends Api implements IApi {
	readonly cdn: string;

	constructor(cdn: string, baseUrl: string, options?: RequestInit) {
		super(baseUrl, options);
		this.cdn = cdn;
	}
}
```

`cdn` - поле которое используется только для чтения. Принимает cdn_url, в формате строки.

Конструктор принимает cdn (базовый URL для CDN) и передает baseUrl и options в конструктор базового класса Api.

##### Методы

- `getProducts` - метод используется для получения информации о товарах с удаленного сервера через 'GET'- запрос на /product.

- `orderProducts` - отправляет данные на удаленный сервер через 'POST'- запрос на /order и возвращает результат. В качестве параметра метод принимает order с типом IOrder.

#### Класс EventEmitter

```
export class EventEmitter implements IEvents {
\_events: Map<EventName, Set<Subscriber>>;

    constructor() {
        this._events = new Map<EventName, Set<Subscriber>>();
    }

}

```

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Конструктор выполняет инициализацию объекта, создавая пустую структуру данных для хранения событий

```
constructor() {
this.\_events = new Map<EventName, Set<Subscriber>>();
}

```

Поля:

events = new Map<EventName, Set<Subscriber>>() - используется для хранения информации о событиях и их подписчиках
Основные методы, реализуемые классом описаны интерфейсом IEvents:

- `on` - установка обработчика на событие;

- `off` - снятие обработчика с события;

- `emit` - инициализация события;

- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие;

- `onAll` - установка слушашателя на все события;

- `offAll` - сброс всех обработчиков с события.

#### Класс Component

Абстрактный класс, который ялвяется базовым классом для компонентов интерфейсаприложения. Имеет общие методы работы с DOM-элементам в приложении.

Конструктор

Принимает HTML-элемент, который является контейнером для компонента

```
protected constructor(protected readonly container: HTMLElement)
```

Методы

- `toggleClass` - принимает в качестве параметра HTML-элемент (element), у которого будет переключаться класс; className - название класса; force - необязательный элемент который принимает булевое значение.

- `setText` - принимает в качестве параметра HTML-элемент, у которого нужно установить текстовое значение и value - текстовое значение.

- `setDisabled` - принимает в качестве параметра HTML-элемент, у которого нужно установить значение атрибута disabled, и state - логическое значение в зависимости от которого устанавливается атрибут.

- `setImage` - принимает в качестве параметра HTML-элемент, у которого нужно нужно установить изображение, src - URL-адрес изображения, и необязательный параметр alt - текстовое значение атрибута alt для изображения

- `render` - метод используется для рендеринга компонента принимает в качестве параметров data - объект, содержащий данные для обновления компонента

#### Класс Form

Класс `Form` представляет собой компонент формы в приложении, наследуемый от базового класса Component. Этот класс предоставляет методы для обработки событий формы, валидации и отображения ошибок. Он также позволяет обрабатывать изменения в полях формы и отправку формы.

Конструктор

```
constructor(container: HTMLFormElement, protected events: IEvents) {...}
```

Принимает в качестве параметров:

- `container` - HTML-элемент формы, который будет контейнером для компонента.

- `events` - интерфейс событий, используемый для эмиссии событий.

Конструктор используется для ининциализации различных компонентов формы, привязывает кнопки и элементы для отображения ошибок. Помимо этого устанавливаются обработчики отправки формы и для ввода данных.

Сеттеры

- `valid` - используется для установки значение кнопки отправки формы. В качестве параметра принимает логическое значение value.

- `errors` - станавливает текст ошибки в элементе ошибок формы. В качестве параметра принимает логическое значение value.

Методы

- onInputChange - метод вызывается при изменении значений формы и эмитирует значение с новым значение поля. В качестве параметров принимает - field: имя поля формы - value: значение поля формы.

- `close` - метод сбрасывает форму до ее первоначального состояния.

- `render` - метод обновляет состояние формы и рендерит ее. В качестве параметра принимает state - объект состояния формы, который содержит поля формы, ошибк и допустимость.

#### Класс Modal

Класс `Modal` применяется для управления модальными окнами в приложении. Он позволяет открывать и закрывать модальные окна, а также обрабатывать события, связанные с этими действиями. Класс наследуется от базового класса Component и использует интерфейс IModal.

Конструктор

```
constructor(container: HTMLElement, protected events: IEvents) {...}
```

Конструктор принимает два параметра - container(TML-элемент контейнера для модального окна) и events (интерфейс для управления событиями)

Конструктор используется для инициализации модальных окон приложения, привязки кнопок и обработчиков событий для закрытия модального окна.

Сеттер

- `content` - изменяет текущий контент модального окна на новый. В качестве параметра принимает value - HTML-элемент, который будет вставлен в качестве старого контена модального окна.

Методы

- `toggleModal` - переключает состояние модального окна, добавляя или удаляя класс `modal_active`. В качестве параметра принимает state - логическое значение, указывающее, должно ли модальное окно быть открытым или нет.

- `handleEscape` - метод закрывает модальное окно при нажатии клавиши "Escape". В качестве параметра принимает evt - событие нажатия кнопки `"Escape"`.

- `open` - открывает модальное окно, добавляет обработчик события нажатия клавиши "Escape" и эмитирует событие открытия модального окна.

- `close` - закрывает модальное окно, удаляет обработчик события нажатия клавиши "Escape", очищает контент модального окна и эмитирует событие закрытия модального окна.

- `render` - рендерит контент модального окна и открывает его. В качестве параметра принимает data - объект состояния модального окна, содержащий контент модального окна.

#### Класс Model

Класс `Model` представляет собой абстрактный базовый класс класс, который применяется для создания моделей данных приложения. Он предоставляет базовую функциональность для инициализации данных модели и эмитирования изменений через события. Класс использует дженерики для обеспечения типизации данных модели и событийного интерфейса `IEvents`.

Конструктор

```
constructor(data: Partial<T>, protected events: IEvents) {...}
```

Конструктор в данном классе используется для инициализации модели данных, происходит копирование данных из объекта, который передается в качестве параметра в экземпляр класса и сохранение ссылки на объект события.

Конструктор принимает data - объект с частичными данными модели. Используется для инициализации свойств модели и events - интерфейс для управления событиями в приложении.

#### Класс PageModel

Класс `PageModel` представляет собой модель страницы приложения, расширяет базовую функциональность класса Model и реализует интерфейс IPage. Данный класс управляет данными и состоянияниями страницы (писок продуктов, информация о заказе и корзина покупок), включает методы управления данными и валидацией этих данных.

Свойства

- `protected \_products: IProductModel[]` - массив продуктов.

- `protected \_order: IOrder` - объект, представляющий заказ, с полями для оплаты, email, телефона, адреса, элементов заказа и общей суммы.

- `protected \_basket: IProductModel[]` - массив продуктов в корзине.

- `protected \_preview: string | null` - идентификатор предварительно просмотренного продукта.

- `protected events: IEvents` - объект для управления событиями.

- `protected formErrors: FormErrors` -объект для хранения ошибок валидации формы.

Сеттеры

- `products(products: IProductModel[])` - устанавливает список продуктов.

- `order(order: IOrder)` - устанавливает информацию о заказе.

- `id(id: string)` - устанавливает идентификатор предварительно просмотренного продукта.

- `preview(cardId: string | null)` - устанавливает идентификатор предварительно просмотренного продукта.

Геттеры

- `products()` - возвращает список продуктов.

- `order()` - возвращает информацию о заказе.

- `basket()` - возвращает список продуктов в корзине.

- `id()` - возвращает идентификатор предварительно просмотренного продукта.

Методы

- `getProduct(cardId: string)` - возвращает продукт по идентификатору. В качестве параметра принимает id товара из карточки товара.

- `сlearBasket()` - очищает корзину.

- `addToBasket(product: IProductModel)` - добавляет продукт в корзину, если его там еще нет.

- `deleteFromBasket(product: IProductModel)` - удаляет продукт из корзины.

- `setTotal(): number` - возвращает общую стоимость продуктов в корзине.

- `validateOrderForm()` - валидирует форму заказа и возвращает true, если ошибок нет.

- `validateContacts()` - валидирует контактную информацию и возвращает true, если ошибок нет.

- `setOrderField(field: keyof TOrder, value: string)` - устанавливает значение для указанного поля заказа и валидирует форму заказа и контактную информацию.

#### BasketView

Класс `BasketView` обеспечивает управление корзиной покупок в приложении, включая отображение продуктов, общую стоимость и возможность оформления заказа.

Конструктор

```
constructor(container: HTMLElement, protected events: IEvents)
```

Конструктор нициализирует экземпляр BasketView. Принимает в качестве параметров container - HTML-элемент, представляющий контейнер для корзины и events - объект для управления событиями.

items - количество выбранных продуктов.

Свойства

- `\_basketList` - HTML-элемент, представляющий список продуктов в корзине.

- `\_count` - HTML-элемент, отображающий общее количество или стоимость продуктов в корзине.

- `\_button` - HTML-кнопка для оформления заказа.

Сеттеры

- `products(products: HTMLElement[])` - обновляет список продуктов в корзине.

products - массив HTML-элементов, представляющих продукты.

- `count(total: number)` - устанавливает общее количество товаров в корзине. В качестве параметра принимает число, которое указывает цену.

- `selected(items: number)` - включает или отключает кнопку оформления заказа в зависимости от количества выбранных продуктов.

#### CardView

Класс `CardView` обеспечивает управление отображением карточки товара в приложении, включая заголовок, изображение, описание, цену и действия, связанные с товаром.

Конструктор

```
constructor(className: string, parentElement: HTMLElement, actions?: IProductActions):
```

Конструктор инициализирует свойства карточки товара, находит необходимые HTML-элементы и добавляет обработчики событий для кнопки и карточки товара. В качестве параметров className - навание класса HTML-элемента, parentElement - HTML-элемент, представляющий контейнер для карточки и actions - бъект с действиями для карточки товара.

Свойства

- `\_index` - HTML-элемент, представляющий индекс карточки товара.

- `\_category` - HTML-элемент, представляющий категорию товара.

- `\_title` - HTML-элемент, представляющий заголовок товара.

- `\_image` - HTML-элемент, представляющий изображение товара.

- `\_description` - HTML-элемент, представляющий описание товара.

- `\_price` - HTML-элемент, представляющий цену товара.

- `\_button` - HTML-кнопка для добавления товара в корзину.

- `\_categoryColor` - объект, сопоставляющий категории товара с CSS-классами.

Сеттеры

- `index(value: number | null)` устанавливает индекс карточки товара. В качестве параметра принимает индекс карточки товара.

- `category(value: string)` - устанавливает категорию товара и соответствующий CSS-класс. value: категория товара.

- `title(value: string)` - устанавливает заголовок товара.

value: заголовок товара.

- `image(value: string)` - устанавливает изображение товара. В качестве параметра принимает value url-изображение товара.

- `description(value: string)` - устанавливает описание товара. В качестве параметра принимает value описание товара.

- `price(value: string)` -устанавливает цену товара и управляет состоянием кнопки. В качестве параметра принимает value цену товара

Геттеры

- `button()` - возвращает кнопку для добавления товара в корзину.

#### ContactsFormView

Класс, `ContactsFormView` наследует функциональность базового класса `Form<IOrder>`. Класс предназначен для управления формой ввода контактных данных пользователя, таких как email и телефон.

Конструктор

```
constructor(container: HTMLFormElement, events: IEvents){...}
```

В качестве параметров конструктор принимает container - HTML-элемент формы, содержащий элементы ввода и
events - объект для обработки событий.

Свойства

- `\_emailInput` - HTML-элемент для ввода для email.

- `\_phoneInput` - HTML-элемент ввода для номера телефона.

Сеттеры

- `phone(value: string)` - устанавливает значение поля ввода номера телефона. Принимает в качестве параметра строку из инпута с номером телефона пользователя.

- `email(value: string)` - устанавливает значение поля ввода email. Принимает в качестве параметра строку из инпута с email.

#### OrderFormView

Класс `OrderFormView` наследует функциональность базового класса `Form<IOrder>`, предназначенный для управления формой заказа, включая выбор способа оплаты и ввод адреса.

Конструктор

```
constructor(container: HTMLFormElement, events: IEvents){...}
```

В качестве параметров конструктор принимает container - HTML-элемент формы, содержащий элементы ввода и
events - объект для обработки событий.

Свойства

- `cardButton` - HTML-элемент кнопки для выбора оплаты картой.

- `cashButton` - HTML-элемент кнопки для выбора оплаты наличными.

- `\_addressInput` - HTML-элемент ввода для адреса.

- `\_payment` - строка, представляющая способ оплаты (наличные или карта).

Сеттеры

- `address(value: string)` - устанавливает значение поля ввода адреса. Параметром принимает строку с адресом.

Методы

- `toggleCardButton(state: boolean = true)` - включает или выключает активное состояние кнопки для оплаты картой. Параметром принимает булево значение.

- `toggleCashButton(state: boolean = true)` - включает или выключает активное состояние кнопки для оплаты наличными. Параметром принимает булево значение.

- `setPayment(button: HTMLButtonElement)` - устанавливает способ оплаты на основе состояния выбранной кнопки. В параметр принимает элемент кнопки.

#### SuccessFormView

Класс `SuccessFormView` наследуется от `Component<ISuccessView>`, предназначенный для отображения информации о успешном заказе, включая общую сумму, списанную с клиента.

Конструктор

```
constructor(container: HTMLElement, actions: ISuccessActions){...}
```

Конструктор в качестве параметра принимает container - HTML-элемент, в котором размещается форма успешного заказа и actions - объект с действиями, которые можно выполнить при взаимодействии с элементами формы.

Если передано действие onClick, добавляется обработчик события click на кнопку закрытия, который выполнит указанное действие при нажатии.

Свойства

- `\_close` - HTML-элемент кнопки закрытия формы успешного заказа.
- `\_total` - HTML-элемент, отображающий общую сумму, списанную с клиента.

Сеттеры

- `total(value: number)` - устанавливает текстовое содержимое элемента \_total, отображая сумму, списанную с клиента.
  Параметром принимает число представляющее общую сумму, списанную с клиента.

#### Класс PageView

Класс `PageView` унаследованный от базового класса `Component<IPage>`, предназначен для управления отображением страницы приложения, включая счетчик товаров в корзине и каталог товаров.

Конструктор

```
constructor(container: HTMLElement, events: IEvents){...}
```

Конструктор в качестве параметра принимает container - HTML-элемент, в котором размещается содержимое страницы и events - объект для управления событиями в приложении.

При создании экземпляра класса добавляется обработчик события `click` на элемент корзины, который вызывает событие `basket:open` для открытия корзины.

Свойства

- `_counter` - HTML-элемент, отображающий количество товаров в корзине.
- `_catalogBlock` - HTML-элемент, содержащий каталог товаров.
- `_wrapperBlock` - HTML-элемент, служащий оберткой для контента страницы.
- `_basketElement` - HTML-элемент, представляющий корзину.

Сеттеры

- `counter(value: number)` - устанавливает текстовое содержимое элемента \_counter, отображая количество товаров в корзине. Параметром принимает число, представляющее количество товаров.

- `catalog(items: HTMLElement[])` - обновляет содержимое каталога, заменяя старые элементы новыми. Параметром принимает массив HTML-элементов, представляющих товары.

- `locked(value: boolean)` - блокирует или разблокирует взаимодействие с контентом страницы. Параметром принимает булево значение указывающее, заблокирована ли страница.

### Взаимодействие компнонетов

Взаимодействие осуществляется за счет событий, генерируемых с помощью броекера событий и их обработчиков.

Список событий, которые могут генерироваться в системе

- `modal:open` - открытие модального окна

- `modal:close` - закрытие модального окна

- `productsData:loaded` - загрузка карточек с сервера

- `card:select` - выбор карточки

- `card:deletefromcart` - удаление карточки из корзины

- `card:addtocart` - добавление карточки в корзину

- `basket:open` - открытие корзины

- `order-form:open`- открытие формы с заказом

- `form-errors:change` - изменение сообщений об ошибках ввода

- `payment:take` - выбор способа оплаты

- `order:submit` - подтверждение заказа

- `contacts:submit`- подтверждение оплаты

## Ссылка на проект

https://github.com/Saitnbone/web-larek-frontend.git
